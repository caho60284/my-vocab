<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>My Vocab Ultimate</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:#f3f5f9}

header{position:sticky;top:0;background:#fff;padding:14px;
box-shadow:0 2px 6px rgba(0,0,0,.08);z-index:10}

h1{margin:0;font-size:22px}
.count{font-size:13px;color:#666;margin-top:2px}

.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
button{border:none;border-radius:10px;padding:10px 12px;font-size:14px}

.import{background:#1e88e5;color:#fff}
.export{background:#6a5acd;color:#fff}
.deleteall{background:#e53935;color:#fff}
.favbtn{background:#f39c12;color:#fff}
.refresh{background:#27ae60;color:#fff}
.pronounce{background:#14b8a6;color:#fff;box-shadow:0 2px 6px rgba(20,184,166,.35)}
.pronounce:hover{background:#0ea5a0;transform:translateY(-1px)}
.pronounce:active{transform:translateY(0);box-shadow:0 1px 3px rgba(20,184,166,.25)}
.add{background:#e3f2fd}

.search{margin-top:10px;width:100%;padding:12px;border-radius:12px;
border:1px solid #ccc;font-size:16px}

main{padding:14px}

.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;position:relative}
.word{font-weight:700;font-size:18px}
.pron{color:#26a69a;margin-top:2px}
.meaning{margin-top:2px;word-break:break-word}

.icons{margin-top:6px}
.icons span{font-size:20px;margin-right:8px}

.star{position:absolute;right:12px;top:12px;font-size:22px;cursor:pointer}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);
display:none;align-items:center;justify-content:center;padding:14px;z-index:99}

.modal-content{background:#fff;border-radius:16px;padding:14px;width:100%;
max-width:420px;max-height:90vh;overflow:auto}

.modal-content input,
.modal-content textarea{
width:100%;margin-bottom:10px;padding:12px 14px;
border-radius:10px;border:1px solid #ccc;font-size:16px
}

.modal-content textarea{
resize:none;overflow:hidden;white-space:pre-wrap;word-break:break-word
}

.ipa{font-family:Arial,Helvetica,sans-serif}

.modal-actions{display:flex;gap:10px;margin-top:6px}
.modal-actions button{flex:1}

.save{background:#1e88e5;color:#fff}
.delete{background:#e53935;color:#fff}
.cancel{background:#bbb}
.audio{background:#2ecc71;color:#fff}

/* indikator recording */
.recording{
background:#e53935 !important;
color:#fff !important;
animation:pulse 1s infinite;
}

@keyframes pulse{
0%{box-shadow:0 0 0 0 rgba(229,57,53,.5)}
70%{box-shadow:0 0 0 10px rgba(229,57,53,0)}
100%{box-shadow:0 0 0 0 rgba(229,57,53,0)}
}
</style>
</head>

<body>

<header>
<h1>üìò My Vocab Ultimate</h1>
<div class="count" id="count">Total vocabulary: 0 words</div>

<div class="controls">
<button class="import" onclick="importCSV()">üì• Import</button>
<button class="export" onclick="exportCSV()">üì§ Export</button>
<button class="deleteall" onclick="deleteAll()">üß® Delete All</button>
<button class="favbtn" onclick="toggleFavView()">‚≠ê Favorites</button>
<button class="refresh" onclick="resetView()">üîÑ</button>
<button class="pronounce" onclick="openChecker()">Pronounce</button>
<button class="add" onclick="openModal()">Ôºã</button>
</div>

<input class="search" id="search" placeholder="Search word or meaning..." oninput="render()">
</header>

<main id="list"></main>

<!-- vocab modal -->
<div class="modal" id="modal">
<div class="modal-content">
<input id="word" placeholder="Word">
<input id="pron" class="ipa" placeholder="Pronunciation">
<textarea id="meaning" rows="2" placeholder="Meaning"></textarea>

<textarea id="ex1" rows="2" placeholder="Example 1"></textarea>
<textarea id="ipa1" class="ipa" rows="2" placeholder="IPA Example 1"></textarea>
<textarea id="tr1" rows="2" placeholder="Translation 1"></textarea>

<textarea id="ex2" rows="2" placeholder="Example 2"></textarea>
<textarea id="ipa2" class="ipa" rows="2" placeholder="IPA Example 2"></textarea>
<textarea id="tr2" rows="2" placeholder="Translation 2"></textarea>

<div class="modal-actions">
<button class="audio" onclick="speakExample(1)">üîä Ex1</button>
<button class="audio" onclick="speakExample(2)">üîä Ex2</button>
</div>

<div class="modal-actions">
<button class="save" onclick="save()">Save</button>
<button class="delete" onclick="remove()">Delete</button>
<button class="cancel" onclick="closeModal()">Cancel</button>
</div>
</div>
</div>

<!-- checker modal -->
<div class="modal" id="checkerModal">
<div class="modal-content">
<input id="checkInput" placeholder="Type word..." oninput="loadCheckWord()">
<div id="checkWord" style="font-size:22px;font-weight:700;margin-top:6px"></div>
<div id="checkIPA" style="color:#26a69a;margin-bottom:10px"></div>

<div class="modal-actions">
<button class="audio" onclick="hearWord()">Hear</button>
<button id="testBtn" class="save" onclick="testWord()">Test</button>
<button class="cancel" onclick="closeChecker()">Close</button>
</div>

<div id="checkResult" style="margin-top:8px"></div>
<div id="checkScore" style="font-size:13px;color:#666"></div>
</div>
</div>

<script>
const listEl = document.getElementById("list")
const countEl = document.getElementById("count")
const modal = document.getElementById("modal")
const checkerModal = document.getElementById("checkerModal")

let data = JSON.parse(localStorage.getItem("vocab")||"[]")
let editIndex=null
let favOnly=false

function saveStorage(){
localStorage.setItem("vocab",JSON.stringify(data))
}

function render(){
const q=document.getElementById("search").value.toLowerCase()
listEl.innerHTML=""

let arr=data.filter(v=>{
if(favOnly && !v.fav) return false
return v.word.toLowerCase().includes(q) ||
(v.meaning||"").toLowerCase().includes(q)
})

countEl.innerText=`Total vocabulary: ${data.length} words`

arr.forEach(v=>{
const i = data.indexOf(v)
const d=document.createElement("div")
d.className="card"
d.innerHTML=`
<div class="word">${v.word}</div>
<div class="pron">${v.pron||""}</div>
<div class="meaning">${v.meaning||""}</div>

<div class="icons">
<span onclick="speak('${v.word}')">üîä</span>
<span onclick="speakSlow('${v.word}')">üê¢</span>
<span onclick="edit(${i})">‚úèÔ∏è</span>
</div>

<div class="star" onclick="toggleFav(${i})">${v.fav?"‚≠ê":"‚òÜ"}</div>
`
listEl.appendChild(d)
})

saveStorage()
}

function openModal(){
editIndex=null
word.value=pron.value=meaning.value=""
ex1.value=ipa1.value=tr1.value=""
ex2.value=ipa2.value=tr2.value=""
modal.style.display="flex"
}
function closeModal(){modal.style.display="none"}

function save(){
const v={
word:word.value,
pron:pron.value,
meaning:meaning.value,
ex1:ex1.value,
ipa1:ipa1.value,
tr1:tr1.value,
ex2:ex2.value,
ipa2:ipa2.value,
tr2:tr2.value,
fav:editIndex!==null?data[editIndex].fav:false
}
if(editIndex===null)data.push(v)
else data[editIndex]=v
closeModal();render()
}

function edit(i){
editIndex=i
const v=data[i]
word.value=v.word||""
pron.value=v.pron||""
meaning.value=v.meaning||""
ex1.value=v.ex1||""
ipa1.value=v.ipa1||""
tr1.value=v.tr1||""
ex2.value=v.ex2||""
ipa2.value=v.ipa2||""
tr2.value=v.tr2||""
modal.style.display="flex"
}

function remove(){
if(editIndex!==null){data.splice(editIndex,1);closeModal();render()}
}

function deleteAll(){
if(confirm("Delete all vocabulary?")){data=[];render()}
}

function toggleFav(i){data[i].fav=!data[i].fav;render()}
function toggleFavView(){favOnly=!favOnly;render()}
function resetView(){favOnly=false;search.value="";render()}

function speak(t){speechSynthesis.speak(new SpeechSynthesisUtterance(t))}
function speakSlow(t){let u=new SpeechSynthesisUtterance(t);u.rate=0.6;speechSynthesis.speak(u)}
function speakExample(n){if(n===1&&ex1.value)speak(ex1.value);if(n===2&&ex2.value)speak(ex2.value)}

function exportCSV(){
let csv="word,pronunciation,meaning,example1,ipa1,translation1,example2,ipa2,translation2,fav\n"
data.forEach(v=>{
csv+=`"${v.word}","${v.pron}","${v.meaning}","${v.ex1}","${v.ipa1}","${v.tr1}","${v.ex2}","${v.ipa2}","${v.tr2}","${v.fav?1:0}"\n`
})
const a=document.createElement("a")
a.href = URL.createObjectURL(new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8;"}))
a.download="my-vocab-Ultimate.csv"
a.click()
}

function importCSV(){
const i=document.createElement("input")
i.type="file";i.accept=".csv"
i.onchange=e=>{
const r=new FileReader()
r.onload=()=>{
const lines=r.result.split(/\r?\n/).slice(1)
data=[]
lines.forEach(l=>{
if(!l.trim())return
const c=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
if(!c)return
data.push({
word:c[0].replace(/"/g,""),
pron:c[1].replace(/"/g,""),
meaning:c[2].replace(/"/g,""),
ex1:c[3].replace(/"/g,""),
ipa1:c[4].replace(/"/g,""),
tr1:c[5].replace(/"/g,""),
ex2:c[6].replace(/"/g,""),
ipa2:c[7].replace(/"/g,""),
tr2:c[8].replace(/"/g,""),
fav:c[9]=="1"
})
})
render()
alert("Import success ‚úÖ")
}
r.readAsText(e.target.files[0])
}
i.click()
}

render()

/* ===== PRONUNCIATION CHECKER ===== */
let currentCheckWord=""
let attempts=0
let correct=0
let recognition=null

function openChecker(){
checkerModal.style.display="flex"
document.getElementById("checkInput").focus()
}

function closeChecker(){
checkerModal.style.display="none"
checkInput.value=""
checkWord.innerText=""
checkIPA.innerText=""
checkResult.innerText=""
checkScore.innerText=""
}

async function loadCheckWord(){
currentCheckWord = checkInput.value.trim().toLowerCase()
if(!currentCheckWord) return
checkWord.innerText=currentCheckWord
checkResult.innerText=""
fetchIPA(currentCheckWord)
}

async function fetchIPA(w){
try{
let r=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${w}`)
let j=await r.json()
let ipa=j[0]?.phonetics?.find(p=>p.text)?.text || ""
checkIPA.innerText=ipa
}catch{
checkIPA.innerText=""
}
}

function hearWord(){
if(!currentCheckWord) return
speak(currentCheckWord)
}

function testWord(){
if(!currentCheckWord) return

const btn = document.getElementById("testBtn")
btn.classList.add("recording")

const SR = window.SpeechRecognition || window.webkitSpeechRecognition
if(!SR){
  checkResult.innerHTML="Speech not supported"
  btn.classList.remove("recording")
  return
}

const recognition = new SR()
recognition.lang = "en-US"
recognition.interimResults = false
recognition.maxAlternatives = 1

recognition.onresult = e=>{
  let spoken = e.results[0][0].transcript.toLowerCase()
  attempts++

  if(spoken.includes(currentCheckWord)){
    correct++
    checkResult.innerHTML="‚úî Correct"
    playCling()
  }else{
    checkResult.innerHTML="‚úñ Wrong"
    playBeep()
    hearWord()
  }

  updateScore()
  btn.classList.remove("recording")
  recognition.stop()
}

recognition.onerror = ()=>{
  btn.classList.remove("recording")
}

recognition.onend = ()=>{
  btn.classList.remove("recording")
}

recognition.start()
}

function updateScore(){
let pct=Math.round((correct/attempts)*100)
checkScore.innerText=`Score: ${pct}% (${correct}/${attempts})`
}

function playCling(){
new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg").play()
}
function playBeep(){
new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play()
}
</script>

</body>
</html>
