<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>My Vocab Ultimate</title>

<style>
/* ==== SEMUA STYLE KAMU TIDAK DIUBAH ==== */
</style>
</head>

<body>
<!-- ==== SEMUA HTML KAMU TIDAK DIUBAH ==== -->

<script>
let data=JSON.parse(localStorage.getItem("vocab")||"[]")
let editIndex=null
let favOnly=false

/* =========================
   TAMBAHAN: ENGLISH WORD
========================= */
let currentCheckWord=""

/* =========================
   SEMUA KODE KAMU ASLI
========================= */

function speak(t){speechSynthesis.speak(new SpeechSynthesisUtterance(t))}

/* =========================
   CHECKER LOAD
========================= */
async function loadCheckWord(){
let raw = checkInput.value.trim()

if(!raw){
  checkWord.innerText=""
  checkIPA.innerText=""
  checkResult.innerHTML=""
  currentCheckWord=""   // reset
  return
}

/* ==== SET WORD TAMPIL ==== */
checkWord.innerText = raw

/* ==== TAMBAHAN: SET ENGLISH ==== */
currentCheckWord = raw.toLowerCase()

// translate dua arah
let indo = await fetchIndoMeaning(raw)
let eng = await fetchEnglishMeaning(raw)

// jika input Inggris
if(indo && indo.toLowerCase() !== raw.toLowerCase()){
  checkResult.innerHTML = "Arti: " + indo

  try{
    let r = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${raw.toLowerCase()}`)
    let j = await r.json()
    let ipa = j[0]?.phonetics?.find(p=>p.text)?.text || ""
    checkIPA.innerText = ipa
  }catch{
    checkIPA.innerText=""
  }

  /* ==== ENGLISH SUDAH BENAR ==== */
  currentCheckWord = raw.toLowerCase()
  return
}

// jika input Indo
if(eng && eng.toLowerCase() !== raw.toLowerCase()){
  checkResult.innerHTML = "English: " + eng
  checkIPA.innerText = ""

  /* ==== TAMBAHAN: SIMPAN ENGLISH ==== */
  currentCheckWord = eng.toLowerCase()
  return
}

// fallback
checkResult.innerHTML = ""
checkIPA.innerText = ""
currentCheckWord = raw.toLowerCase()
}

/* =========================
   HEAR → ENGLISH
========================= */
function hearWord(){
  if(currentCheckWord) speak(currentCheckWord)
}

/* =========================
   TEST → ENGLISH
========================= */
function testWord(){
if(!currentCheckWord)return

const btn=document.getElementById("testBtn")
const wave=document.getElementById("wave")
btn.classList.add("recording")
wave.style.display="flex"

const SR=window.SpeechRecognition||window.webkitSpeechRecognition
if(!SR){btn.classList.remove("recording");wave.style.display="none";return}

const recognition=new SR()
recognition.lang="en-US"

recognition.onresult = e => {

  let spoken = (e.results[0][0].transcript || "")
    .toLowerCase()
    .replace(/[^a-z']/g,"")

  let target = (currentCheckWord || "")
    .toLowerCase()
    .replace(/[^a-z']/g,"")

  if(spoken.includes(target) && target.length>0){
    checkResult.innerHTML="✔ Correct"
  }else{
    checkResult.innerHTML="✖ Wrong"
    hearWord()
  }

  btn.classList.remove("recording")
  wave.style.display="none"
  recognition.stop()
}

recognition.onerror=()=>{
btn.classList.remove("recording")
wave.style.display="none"
}

recognition.onend=()=>{
btn.classList.remove("recording")
wave.style.display="none"
}

recognition.start()
}
</script>
</body>
</html>