<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>My Vocab Ultimate</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:#f3f5f9}

header{position:sticky;top:0;background:#fff;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,.08);z-index:10}
h1{margin:0;font-size:22px}
.count{font-size:13px;color:#666;margin-top:2px}

.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
button{border:none;border-radius:10px;padding:10px 12px;font-size:14px}

.import{background:#1e88e5;color:#fff}
.export{background:#6a5acd;color:#fff}
.deleteall{background:#e53935;color:#fff}
.favbtn{background:#f39c12;color:#fff}
.refresh{background:#27ae60;color:#fff}
.pronounce{background:#14b8a6;color:#fff}
.add{background:#e3f2fd}

.search{margin-top:10px;width:100%;padding:12px;border-radius:12px;border:1px solid #ccc;font-size:16px}

main{padding:14px}

.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;position:relative}
.word{font-weight:700;font-size:18px;cursor:pointer}
.pron{color:#26a69a;margin-top:2px}
.meaning{margin-top:2px}
.icons{margin-top:6px}
.icons span{font-size:20px;margin-right:8px}
.star{position:absolute;right:12px;top:12px;font-size:22px;cursor:pointer}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:14px;z-index:99}
.modal-content{background:#fff;border-radius:16px;padding:14px;width:100%;max-width:420px}

.modal-content input,.modal-content textarea{
width:100%;margin-bottom:10px;padding:12px;border-radius:10px;border:1px solid #ccc;font-size:16px
}

.modal-actions{display:flex;gap:10px;margin-top:6px}
.modal-actions button{flex:1}

.save{background:#1e88e5;color:#fff}
.delete{background:#e53935;color:#fff}
.cancel{background:#bbb}
.audio{background:#2ecc71;color:#fff}

/* waveform */
.waveBtn{position:relative;overflow:hidden}
.wave{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:3px}
.wave span{width:3px;height:10px;background:white;border-radius:2px;animation:wave 1s infinite}
.wave span:nth-child(2){animation-delay:.1s}
.wave span:nth-child(3){animation-delay:.2s}
.wave span:nth-child(4){animation-delay:.3s}
.wave span:nth-child(5){animation-delay:.4s}

@keyframes wave{
0%,100%{height:8px}
50%{height:18px}
}

.recording{background:#3b82f6 !important;color:transparent !important}
</style>
</head>

<body>

<header>
<h1>üìò My Vocab Ultimate</h1>
<div class="count" id="count"></div>

<div class="controls">
<button class="import" onclick="importCSV()">üì• Import</button>
<button class="export" onclick="exportCSV()">üì§ Export</button>
<button class="deleteall" onclick="deleteAll()">üß® Delete All</button>
<button class="favbtn" onclick="toggleFavView()">‚≠ê Favorites</button>
<button class="refresh" onclick="resetView()">üîÑ</button>
<button class="pronounce" onclick="openChecker()">Pronounce</button>
<button class="add" onclick="openModal()">Ôºã</button>
</div>

<input class="search" id="search" placeholder="Search word or meaning..." oninput="render()">
</header>

<main id="list"></main>

<!-- checker -->
<div class="modal" id="checkerModal">
<div class="modal-content">

<div style="display:flex;gap:6px;align-items:center">
  <input id="checkInput" placeholder="Type word..." oninput="loadCheckWord()">
  <button onclick="clearCheck()" style="margin-left:6px">‚Üª</button>
</div>

<div id="checkWord" style="font-size:22px;font-weight:700"></div>
<div id="checkIPA" style="color:#26a69a"></div>

<!-- ‚úÖ arti dipisah -->
<div id="checkMeaning"></div>

<!-- ‚úÖ correct/wrong -->
<div id="checkResult"></div>

<div class="modal-actions">
<button class="audio" onclick="hearWord()">Hear</button>

<button id="testBtn" class="save waveBtn" onclick="testWord()">
<span class="label">Test</span>
<div class="wave" id="wave" style="display:none">
<span></span><span></span><span></span><span></span><span></span>
</div>
</button>

<button class="cancel" onclick="closeChecker()">Close</button>
</div>

</div>
</div>

<script>
let checkEnglish=""

async function fetchIndoMeaning(text){
try{
let r=await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=id&dt=t&q="+encodeURIComponent(text))
let j=await r.json()
return j[0]?.map(x=>x[0]).join("")||""
}catch{return""}
}

async function fetchEnglishMeaning(text){
try{
let r = await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=id&tl=en&dt=t&q=" + encodeURIComponent(text))
let j = await r.json()
return j[0]?.map(x=>x[0]).join("") || ""
}catch{return ""}
}

async function loadCheckWord(){
let raw = checkInput.value.trim()
checkEnglish=""

if(!raw){
  checkWord.innerText=""
  checkIPA.innerText=""
  checkMeaning.innerHTML=""
  checkResult.innerHTML=""
  return
}

checkWord.innerText = raw

let indo = await fetchIndoMeaning(raw)
let eng = await fetchEnglishMeaning(raw)

if(indo && indo.toLowerCase() !== raw.toLowerCase()){
  checkMeaning.innerHTML = "Arti: " + indo
  checkIPA.innerText=""
  checkResult.innerHTML=""
  return
}

if(eng && eng.toLowerCase() !== raw.toLowerCase()){
  checkMeaning.innerHTML = "English: " + eng
  checkIPA.innerText=""
  checkEnglish = eng
  checkResult.innerHTML=""
  return
}

checkMeaning.innerHTML=""
checkIPA.innerText=""
checkResult.innerHTML=""
}

function hearWord(){
  if(checkEnglish){
    speak(checkEnglish)
  }else if(checkWord.innerText){
    speak(checkWord.innerText)
  }
}

function testWord(){
if(!checkWord.innerText)return
const btn=document.getElementById("testBtn")
const wave=document.getElementById("wave")
btn.classList.add("recording")
wave.style.display="flex"

const SR=window.SpeechRecognition||window.webkitSpeechRecognition
if(!SR){btn.classList.remove("recording");wave.style.display="none";return}

const recognition=new SR()
recognition.lang="en-US"

recognition.onresult = e => {
  let spoken = (e.results[0][0].transcript || "").toLowerCase().replace(/[^a-z']/g,"")
  let target = (checkEnglish || checkWord.innerText || "").toLowerCase().replace(/[^a-z']/g,"")

  if(spoken.includes(target) && target.length>0){
    checkResult.innerHTML="‚úî Correct"
  }else{
    checkResult.innerHTML="‚úñ Wrong"
    hearWord()
  }

  btn.classList.remove("recording")
  wave.style.display="none"
  recognition.stop()
}

recognition.onerror=()=>{
btn.classList.remove("recording")
wave.style.display="none"
}

recognition.onend=()=>{
btn.classList.remove("recording")
wave.style.display="none"
}

recognition.start()
}

function clearCheck(){
  const inp = document.getElementById("checkInput")
  inp.value = ""
  loadCheckWord()
  inp.focus()
}
</script>

</body>
</html>